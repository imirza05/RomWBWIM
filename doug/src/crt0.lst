                              1 ;  modified 4/22/2011 for the N8VEM Home Computer Z180 -- John Coffman
                              2 ;
                              3 ;--------------------------------------------------------------------------
                              4 ;  crt0.s - Generic crt0.s for a Z80
                              5 ;
                              6 ;  Copyright (C) 2000, Michael Hope
                              7 ;
                              8 ;  This library is free software; you can redistribute it and/or modify it
                              9 ;  under the terms of the GNU General Public License as published by the
                             10 ;  Free Software Foundation; either version 2.1, or (at your option) any
                             11 ;  later version.
                             12 ;
                             13 ;  This library is distributed in the hope that it will be useful,
                             14 ;  but WITHOUT ANY WARRANTY; without even the implied warranty of
                             15 ;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
                             16 ;  GNU General Public License for more details.
                             17 ;
                             18 ;  You should have received a copy of the GNU General Public License 
                             19 ;  along with this library; see the file COPYING. If not, write to the
                             20 ;  Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                             21 ;   MA 02110-1301, USA.
                             22 ;
                             23 ;  As a special exception, if you link this library with other files,
                             24 ;  some of which are compiled with SDCC, to produce an executable,
                             25 ;  this library does not by itself cause the resulting executable to
                             26 ;  be covered by the GNU General Public License. This exception does
                             27 ;  not however invalidate any other reasons why the executable file
                             28 ;   might be covered by the GNU General Public License.
                             29 ;--------------------------------------------------------------------------
                             30 
                             31 ;;;        .module crt0
                             32        	.globl	_main
                             33 
                             34 	.area	_HEADER (ABS)
                             35 	;; Reset vector
   0000                      36 	.org 	0
   0000 C3r00s01             37 	jp	init
                             38 
   0008                      39 	.org	0x08
   0008 C9                   40 	ret
   0010                      41 	.org	0x10
   0010 C9                   42 	ret
   0018                      43 	.org	0x18
   0018 C9                   44 	ret
   0020                      45 	.org	0x20
   0020 C9                   46 	ret
   0028                      47 	.org	0x28
   0028 C9                   48 	ret
   0030                      49 	.org	0x30
   0030 C9                   50 	ret
   0038                      51 	.org	0x38
   0038 C9                   52 	ret
   0066                      53         .org    0x66    ; NMI interrupt
   0066 ED 45                54         retn
                             55 
   0100                      56 	.org	0x100
   0100                      57 init:
                             58 	;; Stack at the top of memory.
   0100 31 FF FF             59 	ld	sp,#0xffff
                             60 
                             61         ;; Initialise global variables
   0103 CDr00s00             62         call    gsinit
   0106 CDr00s00             63 	call	_main
   0109 C3r00s00             64 	jp	_exit
                             65 
                             66 	;; Ordering of segments for the linker.
                             67 	.area	_HOME
                             68 	.area	_CODE
                             69         .area   _GSINIT
                             70         .area   _GSFINAL
                             71 
                             72 	.area	_DATA
                             73 	.area	_BSEG
                             74         .area   _BSS
                             75         .area   _HEAP
                             76 
                             77         .area   _CODE
                    0000     78 .if 0
                             79 __clock::
                             80 	ld	a,#2
                             81         rst     0x08
                             82 	ret
                             83 .endif
                             84 
   0000                      85 _exit::
                             86 	;; Exit - special code to the emulator
   0000 3E 00                87 	ld	a,#0
   0002 CF                   88         rst     0x08
   0003                      89 1$:
   0003 76                   90 	halt
   0004 18 FD                91 	jr	1$
                             92 
                             93         .area   _GSINIT
   0000                      94 gsinit::
                             95 
                             96         .area   _GSFINAL
   0000 C9                   97         ret
